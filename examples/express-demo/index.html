<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bot Detection Demo</title>
  <style> body { font-family: sans-serif; margin: 2rem; } pre { background: #f5f5f5; padding: 1rem; } </style>
</head>
<body>
  <h1>Bot Detection Demo</h1>
  <p>Interact with the page (move mouse, type) to generate signals.</p>
  <button id="ping">Ping protected route</button>
  <pre id="out"></pre>

  <script type="module">
    // This demo expects the package to be built and served statically if needed.
    // For simplicity, we inline a minimal version by copying compiled client bundle at runtime.
    // In this example, we'll simulate import by a fetch to our telemetry endpoint.
    const out = document.getElementById('out');
    const log = (x) => out.textContent = (typeof x === 'string' ? x : JSON.stringify(x, null, 2));

    // Minimal in-page collector matching the package surface
    let mouseMoves = 0, keyPresses = 0, touchEvents = 0, totalMouseDistance = 0; let last = null; const start = Date.now();
    addEventListener('mousemove', (e)=>{ mouseMoves++; if (last){ totalMouseDistance += Math.hypot(e.clientX-last.x, e.clientY-last.y);} last={x:e.clientX,y:e.clientY}; }, {passive:true});
    addEventListener('keydown', ()=>{ keyPresses++; }, {passive:true});
    addEventListener('touchstart', ()=>{ touchEvents++; }, {passive:true});

    function snapshot(){
      const avgMouseSpeed = mouseMoves ? totalMouseDistance / mouseMoves : 0;
      return {
        userAgent: navigator.userAgent,
        languages: navigator.languages,
        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
        screen: { width: screen.width, height: screen.height, colorDepth: screen.colorDepth },
        devicePixelRatio: devicePixelRatio,
        jsEnabled: true,
        interactions: { mouseMoves, keyPresses, touchEvents, avgMouseSpeed, timeOnPageMs: Date.now() - start },
      };
    }

    setInterval(async ()=>{
      const fp = snapshot();
      try {
        await fetch('/_bot/telemetry', { method: 'POST', headers: { 'content-type': 'application/json' }, body: JSON.stringify(fp), keepalive: true });
      } catch {}
    }, 2000);

    document.getElementById('ping').addEventListener('click', async () => {
      const hdr = btoa(JSON.stringify(snapshot()));
      const res = await fetch('/protected', { headers: { 'x-bot-features': hdr } });
      log({ status: res.status, text: await res.text() });
    });
  </script>
</body>
</html>

